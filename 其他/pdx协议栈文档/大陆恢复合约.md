# restoreLand
###1.使用场景
一条链由于委员会节点的退出,变成岛屿链之后,如果退出的节点不回来,这条链是无法恢复成大陆链的,这个合约就是为了应对这种情况使用的
###2.使用合约的前提条件
条件1.当前节点认为自己是岛屿链
条件2.岛屿链状态持续x个块高度(目前订的是1000个normal块),才能发起大陆恢复合约
条件3.设定m个地址作为合约发起者,满足条件1和2,合约发起者就可以进行合约投票,票数达到2/3后,才可以触发大陆恢复合约(如果没有设定发起者,就以第一个出块节点作为发起者),合约每生效一次,该合约地址nonce+1,每次投票都是以合约地址nonce作为轮数

    

#####满足条件1和2就可以进行合约投票了,发起者发起合约交易,就认定是投出一条,具体方法如下

```
//合约地址
to:=common.BytesToAddress(crypto.Keccak256([]byte("RestoreLand"))[12:])
//合约的轮数,就是当前合约地址的nonce
vote, _ := client.EthClient.NonceAt(ctx, to, nil)
//nonce进行json编码,放到交易的data字段
bytes, _ := json.Marshal(vote)
//生成交易
tx := types.NewTransaction(uint64(nonce), to, amount, gasLimit, gasPrice, bytes)
amount=0
gasLimit和gasPrice用方法进行预估

```


###3.合约触发
合约触发后会在100个块后生效,生效后会清除本地的岛屿信息,并且把自己的大陆版本号+1

###4.合约触发后
合约触发后版本号会增加,如果收到大陆版本不相同的区块,会比较版本号,如果版本比本地低,直接无视这个区块,如果比本地高,则要验证对方的版本号,本地节点会发出验证请求,请求对方带有大陆恢复合约的区块,
本地节点收到这些区块后,会找出这些块中带有大陆恢复合约的交易,查看交易数量,
交易数量必须大于最小值(版本号x发起者x2/3)

