# Layer2

## 1.什么是Layer2
 Layer2是指区块链技术和网络协议用于扩展基础区块链的解决方案。其目的是提高交易速度，降低费用，增强网络可扩展性和效率。Layer2通过主链外大量交易，然后将结果批量提交到主链，从而减轻主链的负担
 
## 1.1 关键特点和技术
- 扩展性：layer2解决方案可以处理更多的交易量，缓解Layer1上的拥堵
- 成本降低：通过在链下处理交易，可以显著降低用户交易费用
- 提高速度：由于交易不需要再主链上逐一确认
- 安全性：尽管交易链下处理，但依赖于主链的安全性来保证最终的交易结果可信与否

## 2.常见的Layer2解决方案

### 状态通道（State Channels）
这种方法允许允许两方或多方再链下进行多次交易，只在交易结束时将最终状态提交到区块链。例子：闪电网络

### 侧链（Sidechains）
侧链是一条独立的区块链，使用其自身的共识机制，但通过双向锚定与主链链接。侧链可以自由的实现不同的功能和优化，同时主链依旧保持其主要的安全和稳定。

### Rollups
Rollups通过将大量交易打包到单一交易中,并将其提交到主链。这种方式可以分为两种类型：1.optimistic  Rollups. 2. zk Rollups。

- Op Rollups:我们默认节点没有说谎对于节点提交的结果采取乐观的信任态度，指定到有节点将自己的异议结果以及calldate数据提交到L1层进行Fraud proof欺诈证明，由L1来决定是否构成欺诈，如果挑战成功则对欺诈节点进行罚没惩罚。
- Zk Rollups:通过零知识证明技术，在提交交易数据的同时，保证其正确性。

### Plasma
Plasma是一种框架，允许创建多层的子链结构，每层可以处理大量的交易。


## 3.Layer2相关术语
### 3.1 模块化
模块化源于Mustafa Albasan和Vitalik在2018年共同撰写的《数据可用性采样和欺诈证明》后经Celestia发扬光大。
模块化行得通源于区块链公链架构的可组合特性，一个成熟公链包括：
- 结算层（Settlement layer）:负责资产的交易状态转移和确定
- DA层（Data Availability）:负责交易数据的状态数据可用性，以供交易验证
- 执行层（Execution layer）:负责处理交易的执行逻辑，包括智能合约的调用和执行
- 共识层(Consensus layer):负责所有节点就某一版本的交易历史打成一致
- 跨链通信层（Interoperability layer）:负责不同区块链网络的消息通信和状态管理

### 3.2 数据可用层
数据可用层是指处理和保证数据可硬性的一层。数据可用性是指数据在需要时可以被访问，验证和使用，这对区块链系统的数据完整性和安全性至关重要。设计目的是：确保所有参与者能够访问和验证区块链上发布的数据，从而保证整个系统的透明和可靠。

#### 3.2.1 数据可用层的关键功能
- **数据存储和分发**：数据可用层负责存储区块链生成的数据，并确保这些数据可以被所有节点访问。
- **数据校验**：该层提供验证机制，允许节点验证数据的完整性和正确性。
- **冗余和容错**: 为了防止是数据丢失或损坏，数据可用层通常会实现数据冗余和容错机制。如：分布式哈希表或复制数据到多个节点

#### 3.2.2 数据可用层在区块链架构中的位置
数据可用层为结算层和执行层提供可靠的数据存储和访问服务。

#### 3.2.3 数据可用层的实现方式
- **链上数据可用性**：传统区块链系统中，所有数据都存储在链上，确保了数据的可用性，但也导致了区块链膨胀和性能问题
- **链下数据可用性**：一些现代区块链系统采用链下数据存储解决链上数据膨胀的问题。如：Rollup技术将大部分数据存储在链下，仅在链上存储数据摘要或证明
- **分片技术**：分片技术将区块链分割成多个小片，每小片存储部分数据

#### 3.2.3 数据可用层挑战
- **数据可用性攻击**：恶意节点在不提供全部数据的情况下发布区块，使得其他节点无法验证数据的完整性
- **存储和带宽限制**：随着区块数据量的增加，存储与带宽需求也会显著增加。数据可用层需要高效的存储和分发应对不断增长的数据需求
- **隐私和安全**：需要设计加密和访问控制机制保护敏感数据

### 3.3 数据可用算法
#### 3.3.1 数据可用性证明（Data Availability Proofs）
用于验证发布的数据是否实际存在且可访问。对于防止数据可用性攻击非常重要。
- **Kate Commitments:**一种基于多项式承诺的方案，可以高效的验证大数据集的可靠性。他使用KZG（Kate-Zaverucha-Goldberg）承诺来证明特定数据块已被正确发布。[KZG-Demo](https://github.com/WuEcho/kzg-demo)

- **Data Avaliability Sampling:**一种随机抽样技术，节点通过随机抽取和验证少量数据片段来确定整个数据集的可用性，此方法降低成本，即使资源有限的节点也可参加验证；


#### 3.3.2 纠删码（Erasure Coding）
纠删码是一种数据编码技术，用于提高数据存储的冗余性和可靠性，通过将数据分成对个片段并添加冗余信息，即使部分数据片段丢失或损坏数据依然可恢复；

- **Reed-Solomon Codes**:一种广泛使用的纠删码，能够从任意k个有效片段中恢复出原始数据，其中K是编码参数。这种编码在存储和分布式系统中被广泛应用

- **LDPC Codes(Low-Density Parity-Check Codes)**:一种高效的纠删码，使用稀疏矩阵进行编码和解码，适用于需要高冗余和低延迟的系统

#### 3.3.3 分布式哈希表(DHT)
节点通过哈希函数确定数据的位置，并在网络中存储和检索数据

- **Kademlia**:常见的DHT实现，使用XOR距离度量来确定节点之间的距离并高效的路有数据请求。

#### 3.3.4 密码学技术
- **Merkle trees**:哈希树结构，用于高效和安全的验证大数据集的完整性。通过根哈希，节点可以快速验证任何数据片段是否属于数据集的一部分;如Celestia里面的npm（命名空间梅克尔树）
- **零知识证明（zkp）**:允许一方在不透漏具体数据的情况下，证明其拥有某些数据的知识，如zk-SNARKs(零知识简洁非交互知识论证) 
 
#### 3.3.5 数据分片（Data Sharding）
数据分片将大量数据集分割成更小的片段，并分布在不同节点上

#### 3.3.6 中心化存储网络
- **IPFS**
- **Filecoin** 

### 3.4 跨链通信层
跨链通信层（Cross-Chain Communication Layer）是指在不同区块链网络之间实现信息和价值互操作的技术和协议。

#### 3.4.1 关键功能
- **互操作性**：跨链通信层允许不同区块链之间的数据和资产互操作。这可以包括转移代币，共享数据，调用跨链智能合约等
- **信任和安全**：需要防范各类攻击如：双花攻击，中间人攻击等
- **兼容性**：需要支持不同区块链的共识机制和数据类型，确保在异构区块链之间的无缝通信

#### 3.4.2 实现方式

- **中继（Relay）**:一种桥接机制，通过中继链或中继节点在不同区块链之间传递信息。中继负责监控源链上的事件，并将这些事件提交到目标链上进行处理。如Polkadot的中继链（Relay chain）连接了不同的平行链（Parachains）实现跨链通信和共享安全
- **原子交换（Atomic Swaps）**:一种去信任的跨链交易方式，利用哈希时间锁合约（HTLC）确保交易双方在不同链上的资产交换同步完成。如bitcoin和Eth之间的原子交换可通过HTLC，确保两链之间的代币交换
- **侧链（Sidechain）**：一种独立的区块链，与主链平行运行，通过双向锚定（two-way peg）机制实现与主链之间的资产转移和数据通信；如:Liquid Network作为比特币的侧链，实现了更快的交易和更高的隐私性 
- **跨链桥（Cross-Chain Bridges）**:一种专门的协议和平台，通过桥接合约或中继器在不同区块链之间传递资产和信息；如：ChainBridge和RenBridge是实现不同区块链之间资产跨链转移的桥接工具
- **去中心化中继器（Decentralized Relayers）**:去中心化中继器网络是一种无需信任的跨链解决方案，通过去中心化的节点网络来验证和传递跨链交易。如：Cosmos的IBC协议


## Rollup 中的一些角色

sequencer: 交易排序器

verifier: 交易证明,sequencer或者是DA将交易提交到L1层以后，根据交易重新生成证明来验证交易是否有效，如果无效将提交fraud proof以及op-code提交到ethereum上进行验证 

prover: （对于zk来说）提供了全op-code的电路证明的交易证明器，链下交易证明的生成。



## kzg  BLS  纠删码 重新质押
- kzg: 零知识证明算法依靠的是trustset（性能高复杂度0（1））
- bls: 聚合签名算法，短签名，性能和安全性都比较高
- 纠删码: 一种数据的编码格式，特点是将一份数据拆分成M份，然后向DA网络中索取至少n份数据就可以恢复出完成的数据，即n/m（m>=n） 
- 重新质押：重新质押依赖于，Liquid Staking Derivatives/Tokens (下文均简称 LSD），是在区块链世界里帮助已被质押的数字资产释放流动性、提升交易性的一种工具，其价值形式类似于「衍生品（亦称衍生资产）」，在表现形式上，LSD 也是一种依照 ERC-20 标准发布的通证，即所谓的「 I Owe You Token（常见简称 IOU Token）」，一般发行在被质押的原生资产以外的区块链或层上。

### 可供参考的项目方

mantle:[浏览器](https://explorer.mantle.xyz/withdrawals)

### 可以参考的项目
[acorus](https://github.com/eniac-x-labs/acorus)

